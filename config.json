{
  "prometheusConfig": {
    "baseUrl": "http://localhost:8428",
    "username": "admin",
    "password": "admin",
    "queryTimeout": "30s",
    "defaultStep": "1m",
    "maxPoints": 30,
    "defaultInterval": "5m"
  },
  "appInstances": [
    {
      "name": "mysql_analyze",
      "description": "通过prometheus mysql exporter的查询语句获取mysql性能指标",
      "queryTemplates": [
        {
          "metric": "uptime_seconds",
          "description": "MySQL 实例累计运行时长(秒)",
          "template": "mysql_global_status_uptime{{labels}}"
        },
        {
          "metric": "qps",
          "description": "每秒查询数(QPS),时间窗口：{{interval}}",
          "template": "rate(mysql_global_status_queries{{labels}}[{{interval}}])"
        },
        {
          "metric": "innodb_buffer_pool_size_bytes",
          "description": "InnoDB 缓冲池大小(字节)",
          "template": "mysql_global_variables_innodb_buffer_pool_size{{labels}}"
        },
        {
          "metric": "max_threads_connected",
          "description": "{{interval}} 内最大并发连接数",
          "template": "sum(max_over_time(mysql_global_status_threads_connected{{labels}}[{{interval}}]))"
        },
        {
          "metric": "max_active_threads",
          "description": "{{interval}} 内最大活动线程数",
          "template": "sum(max_over_time(mysql_global_status_threads_connected{{labels}}[{{interval}}]))"
        },
        {
          "metric": "questions_rate",
          "description": "{{interval}} 内 Questions 命令请求速率",
          "template": "rate(mysql_global_status_questions{{labels}}[{{interval}}])"
        },
        {
          "metric": "thread_cache_size",
          "description": "线程缓存大小(thread_cache_size)",
          "template": "sum(mysql_global_variables_thread_cache_size{{labels}})"
        },
        {
          "metric": "created_tmp_tables_rate",
          "description": "{{interval}}内创建临时表(内存+磁盘)速率",
          "template": "sum(rate(mysql_global_status_created_tmp_tables{{labels}}[{{interval}}]))"
        },
        {
          "metric": "select_full_join_rate",
          "description": "需要全表扫描的 JOIN 每秒次数 (可能的索引缺失)",
          "template": "sum(rate(mysql_global_status_select_full_join{{labels}}[{{interval}}]))"
        },
        {
          "metric": "sort_rows_rate",
          "description": "{{interval}} 内排序处理的行数每秒 (Sort Rows)",
          "template": "sum(rate(mysql_global_status_sort_rows{{labels}}[{{interval}}]))"
        },
        {
          "metric": "slow_queries_rate",
          "description": "{{interval}} 内慢查询发生速率",
          "template": "sum(rate(mysql_global_status_slow_queries{{labels}}[{{interval}}]))"
        },
        {
          "metric": "aborted_connects_rate",
          "description": "失败/中断连接速率",
          "template": "sum(rate(mysql_global_status_aborted_connects{{labels}}[{{interval}}]))"
        },
        {
          "metric": "table_locks_immediate_rate",
          "description": "立即获取表级锁的速率 (成功无需等待)",
          "template": "sum(rate(mysql_global_status_table_locks_immediate{{labels}}[{{interval}}]))"
        },
        {
          "metric": "bytes_received_rate",
          "description": "网络接收字节速率",
          "template": "sum(rate(mysql_global_status_bytes_received{{labels}}[{{interval}}]))"
        },
        {
          "metric": "top_command_counters_rate",
          "description": "时间窗口内最活跃(速率>0)前5类命令及其速率",
          "template": "topk(5, rate(mysql_global_status_commands_total{{labels}}[{{interval}}])>0)"
        },
        {
          "metric": "handlers_total_rate",
          "description": "各类 Handler 操作总速率 (读取/写入/扫描等)",
          "template": "rate(mysql_global_status_handlers_total{{labels}}[{{interval}}]) or irate(mysql_global_status_handlers_total{{labels}}[5m])"
        },
        {
          "metric": "transaction_handlers_rate",
          "description": "事务相关 Handler 操作速率",
          "template": "rate(mysql_global_status_handlers_total{{labels}}[{{interval}}]) or irate(mysql_global_status_handlers_total{{labels}}[5m])"
        },
        {
          "metric": "threads_state",
          "description": "当前线程状态分布 (INFORMATION_SCHEMA.THREADS)",
          "template": "mysql_info_schema_threads{{labels}}"
        },
        {
          "metric": "top_threads_state_1h",
          "description": "过去1小时线程状态平均 Top5",
          "template": "topk(5, avg_over_time(mysql_info_schema_threads{{labels}}[1h]))"
        },
        {
          "metric": "qcache_free_memory_bytes",
          "description": "查询缓存剩余内存 (若启用查询缓存)",
          "template": "mysql_global_status_qcache_free_memory{{labels}}"
        },
        {
          "metric": "qcache_hits_rate",
          "description": "查询缓存命中速率",
          "template": "rate(mysql_global_status_qcache_hits{{labels}}[{{interval}}]) or irate(mysql_global_status_qcache_hits{{labels}}[5m])"
        },
        {
          "metric": "opened_files_rate",
          "description": "文件打开次数速率",
          "template": "rate(mysql_global_status_opened_files{{labels}}[{{interval}}]) or irate(mysql_global_status_opened_files{{labels}}[5m])"
        },
        {
          "metric": "open_files",
          "description": "当前已打开文件数",
          "template": "mysql_global_status_open_files{{labels}}"
        },
        {
          "metric": "opened_tables_rate",
          "description": "表被打开次数速率",
          "template": "rate(mysql_global_status_opened_tables{{labels}}[{{interval}}]) or irate(mysql_global_status_opened_tables{{labels}}[5m])"
        },
        {
          "metric": "open_tables",
          "description": "当前已打开表数量",
          "template": "mysql_global_status_open_tables{{labels}}"
        },
        {
          "metric": "open_table_definitions",
          "description": "当前已缓存的表定义数量",
          "template": "mysql_global_status_open_table_definitions{{labels}}"
        }
      ]
    },
    {
      "name": "redis_analyze",
      "description": "通过prometheus redis exporter的查询语句获取redis性能指标",
      "queryTemplates": [
        {
          "metric": "memory_used",
          "description": "已用内存(bytes)",
          "template": "redis_memory_used_bytes{{labels}}"
        },
        {
          "metric": "memory_fragmentation_ratio",
          "description": "内存碎片率",
          "template": "redis_memory_fragmentation_ratio{{labels}}"
        },
        {
          "metric": "connected_clients",
          "description": "连接客户端数量",
          "template": "redis_connected_clients{{labels}}"
        },
        {
          "metric": "blocked_clients",
          "description": "阻塞客户端数量",
          "template": "redis_blocked_clients{{labels}}"
        },
        {
          "metric": "rejected_connections",
          "description": "拒绝连接次数",
          "template": "redis_rejected_connections_total{{labels}}"
        },
        {
          "metric": "evicted_keys",
          "description": "驱逐键数量",
          "template": "redis_evicted_keys_total{{labels}}"
        },
        {
          "metric": "expired_keys",
          "description": "过期键数量",
          "template": "redis_expired_keys_total{{labels}}"
        },
        {
          "metric": "keyspace_hits",
          "description": "Key命中次数",
          "template": "redis_keyspace_hits_total{{labels}}"
        },
        {
          "metric": "keyspace_misses",
          "description": "Key未命中次数",
          "template": "redis_keyspace_misses_total{{labels}}"
        },
        {
          "metric": "instantaneous_ops_per_sec",
          "description": "每秒操作数(瞬时)",
          "template": "redis_instantaneous_ops_per_sec{{labels}}"
        },
        {
          "metric": "instantaneous_input_kbps",
          "description": "瞬时输入KBps",
          "template": "redis_instantaneous_input_kbps{{labels}}"
        },
        {
          "metric": "instantaneous_output_kbps",
          "description": "瞬时输出KBps",
          "template": "redis_instantaneous_output_kbps{{labels}}"
        },
        {
          "metric": "used_cpu_sys",
          "description": "系统CPU时间",
          "template": "redis_used_cpu_sys{{labels}}"
        },
        {
          "metric": "used_cpu_user",
          "description": "用户CPU时间",
          "template": "redis_used_cpu_user{{labels}}"
        },
        {
          "metric": "used_cpu_sys_children",
          "description": "子进程系统CPU时间",
          "template": "redis_used_cpu_sys_children{{labels}}"
        },
        {
          "metric": "used_cpu_user_children",
          "description": "子进程用户CPU时间",
          "template": "redis_used_cpu_user_children{{labels}}"
        },
        {
          "metric": "connected_slaves",
          "description": "从节点数量",
          "template": "redis_connected_slaves{{labels}}"
        },
        {
          "metric": "repl_backlog_size",
          "description": "复制积压缓冲区大小",
          "template": "redis_repl_backlog_size{{labels}}"
        }
      ]
    },
    {
      "name": "node_analyze",
      "description": "通过 node_exporter 获取主机基础资源(仅保留已验证指标)",
      "queryTemplates": [
        {
          "metric": "cpu_usage_percent",
          "description": "CPU 使用率(简单计算方式) 100 - avg(rate(node_cpu_seconds_total)[{{interval}}])*100",
          "template": "100 - (avg by(instance)(rate(node_cpu_seconds_total{{labels}}[{{interval}}])) * 100)"
        },
        {
          "metric": "memory_usage_percent",
          "description": "内存使用率 (MemTotal-MemFree)/MemTotal *100",
          "template": "(node_memory_MemTotal_bytes{{labels}} - node_memory_MemFree_bytes{{labels}}) / node_memory_MemTotal_bytes{{labels}} * 100"
        },
        {
          "metric": "disk_usage_root_percent",
          "description": "磁盘使用率 (size-free)/size *100",
          "template": "(node_filesystem_size_bytes{{labels}} - node_filesystem_free_bytes{{labels}}) / node_filesystem_size_bytes{{labels}} * 100"
        }
      ]
    }
  ]
}
